---
title: "MINVAL - **MIN**imal **VAL**idation for Stoichiometric Reactions"
author: "Daniel Osorio, Janneth Gonzalez and Andres Pinzon"
#date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to MINVAL}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, dev = "png", fig.width = 7, fig.height = 5, message = FALSE, warning = FALSE)
```
### Introduction to MINVAL
The **MINVAL** package was designed as a tool to identify orphan metabolites and evaluate the mass and charge balance of stoichiometric reactions. The package also includes functions to write models in TSV and SBML formats, extract all reactants, products, metabolite names and compartments from a metabolic reconstruction. It is available through CRAN repositories, to install it just type:
```{r, eval=FALSE}
install.packages("minval")
```
**MINVAL** includes eleven functions designed to check and depurate metabolic reconstructions before its interrogation through Flux Balance Analysis (FBA). FBA methods are available for the R language in the `"sybil"` (**Sy**stems **Bi**ology **L**ibrary) package. To load required packages just type:
```{r, message=FALSE}
library("minval")
library("sybilSBML")
```
### Metabolic Reconstructions
Metabolic reconstructions are sets of stoichiometric reactions that represents chemical reactions. A chemical reaction is a process where a set of chemical compounds called reactants are converted into products.
```{r}
glycolysis <- read.csv(file = system.file("extdata", "glycolysisModel.csv",
                                          package = "minval"), 
                        stringsAsFactors = FALSE,
                        sep = '\t'
                        )
```
```{r}
head(x = glycolysis$REACTION, n = 10)
```
```{r}
colnames(glycolysis)
```
### SBML files
```{r}
writeSBML(modelData = glycolysis,
          modelID = "Glycolysis",
          outputFile = "glycolysis.xml"
          )

glycoModel <- sybilSBML::readSBMLmod("glycolysis.xml")
glycoModel


optimizeProb(glycoModel)
```

```{r}
validateSyntax(reactionList = glycolysis$REACTION)
```

### Mass-Charge Balance
```{r, eval = FALSE}
ChEBI <- downloadChEBI(release = "latest",
                       woAssociations = TRUE
                       )
```

```{r,}
chemicalData <- read.csv2(file = system.file("extdata", "chemData.csv", 
                                             package = "minval")
                          )
```

```{r}
head(chemicalData)
```

```{r}
checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mFormula = "FORMULA"
             )

checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mFormula = "MASS"
             )
```
```{r}
checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mFormula = "CHARGE"
             )
```
### Characterize model
#### Stoichiometric matrix
```{r}
stoichiometricMatrix(reactionList = glycolysis$REACTION)
```
#### Metabolites
```{r}
metabolites(reactionList = glycolysis$REACTION)
```
```{r}
metabolites(reactionList = glycolysis$REACTION,
            woCompartment = TRUE)
```
#### Compartments
```{r}
compartments(reactionList = glycolysis$REACTION)
```
#### OrphanMetabolites
```{r}
orphanMetabolites(reactionList = glycolysis$REACTION)
```
```{r}
orphanReactants(reactionList = glycolysis$REACTION)
orphanProducts(reactionList = glycolysis$REACTION)

```
### TSV files
```{r}
writeTSV(modelData = glycolysis,
          modelID = "Glycolysis",
          outputFile = "glycolysis"
          )

sybil::readTSVmod(prefix = "glycolysis",quoteChar = "\"")
```