---
title: "MINVAL - **MIN**imal **VAL**idation for Stoichiometric Reactions"
author: "Daniel Osorio, Janneth Gonzalez and Andres Pinzon"
#date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to MINVAL}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, dev = "png", fig.width = 7, fig.height = 5, message = FALSE, warning = FALSE)
```
### Introduction to MINVAL
The **MINVAL** package was designed as a tool to identify orphan metabolites and evaluate the mass and charge balance of stoichiometric reactions. The package also includes functions to write models in TSV and SBML formats, extract all reactants, products, metabolite names and compartments from a metabolic reconstruction. It is available through CRAN repositories, to install it just type:
```{r, eval=FALSE}
install.packages("minval")
```
**MINVAL** includes eleven functions designed to check and depurate metabolic reconstructions before its interrogation through Flux Balance Analysis (FBA). FBA methods are available for the R language in the `"sybil"` (**Sy**stems **Bi**ology **L**ibrary) package. To load required packages just type:
```{r, message=FALSE}
library("minval")
library("sybilSBML")
```
### Metabolic Reconstructions
Metabolic reconstructions are sets of stoichiometric reactions that represents chemical reactions. A chemical reaction is a process where a set of chemical compounds called reactants are converted into products. In a stoichiometric reaction, all the reactants are placed on the left and the products on the right separated by an arrow which indicates the direction of the reaction. An example of a stoichiometric reaction is:
```{r, eval= FALSE}
"ATP[c] + 3-Phospho-D-glycerate[c] <=> ADP[c] + 3-Phospho-D-glyceroyl phosphate[c]"
```
**MINVAL** can extract both, reactants and products for a set of stoichiometric reactions through the `reactants` and `products` functions as follows: 

* If the chemical reaction is irreversible `(=>)` then reactants and products are separated and returned afterward.
```{r}
reactants(reactionList = "ATP[c] + alpha-D-Glucose[c] => ADP[c] + alpha-D-Glucose 6-phosphate[c]")
products(reactionList = "ATP[c] + alpha-D-Glucose[c] => ADP[c] + alpha-D-Glucose 6-phosphate[c]")
```
* If the chemical reaction is reversible `(<=>)` then all reactants at some point can act as products and *vice versa*, for that reason the functions return all reaction metabolites.
```{r}
reactants(reactionList = "ATP[c] + 3-Phospho-D-glycerate[c] <=> ADP[c] + 3-Phospho-D-glyceroyl phosphate[c]")
products(reactionList = "ATP[c] + 3-Phospho-D-glycerate[c] <=> ADP[c] + 3-Phospho-D-glyceroyl phosphate[c]")
```
```{r}
glycolysis <- read.csv(file = system.file("extdata", "glycolysisModel.csv",
                                          package = "minval"), 
                        stringsAsFactors = FALSE,
                        sep = '\t'
                        )
```
```{r}
head(x = glycolysis$REACTION, n = 10)
```
```{r}
colnames(glycolysis)
```
### SBML files
```{r}
writeSBML(modelData = glycolysis,
          modelID = "Glycolysis",
          outputFile = "glycolysis.xml"
          )

glycoModel <- sybilSBML::readSBMLmod("glycolysis.xml")
glycoModel


optimizeProb(glycoModel)
```

```{r}
validateSyntax(reactionList = glycolysis$REACTION)
```

### Mass-Charge Balance
```{r, eval = FALSE}
ChEBI <- downloadChEBI(release = "latest",
                       woAssociations = TRUE
                       )
```

```{r,}
chemicalData <- read.csv2(file = system.file("extdata", "chemData.csv", 
                                             package = "minval")
                          )
```

```{r}
head(chemicalData)
```

```{r}
checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mFormula = "FORMULA"
             )

checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mWeight = "MASS"
             )
```
```{r}
checkBalance(reactionList = glycolysis$REACTION,
             referenceData = chemicalData,
             ids = "NAME",
             mCharge = "CHARGE"
             )
```
### Characterize model
#### Stoichiometric matrix
```{r}
stoichiometricMatrix(reactionList = glycolysis$REACTION)
```
#### Metabolites
```{r}
metabolites(reactionList = glycolysis$REACTION)
```
```{r}
metabolites(reactionList = glycolysis$REACTION,
            woCompartment = TRUE)
```
#### Compartments
```{r}
compartments(reactionList = glycolysis$REACTION)
```
#### OrphanMetabolites
```{r}
orphanMetabolites(reactionList = glycolysis$REACTION)
```
```{r}
orphanReactants(reactionList = glycolysis$REACTION)
orphanProducts(reactionList = glycolysis$REACTION)

```
### TSV files
```{r}
writeTSV(modelData = glycolysis,
          modelID = "Glycolysis",
          outputFile = "glycolysis"
          )

sybil::readTSVmod(prefix = "glycolysis",quoteChar = "\"")
```